import { v4 as uuidv4 } from "uuid";
import { deleteUserFromDB, findUser, users } from "../db/user.db.js";

export const getUsers = (req, res) => {
  res.send(users);
};


/*
    firstName
    lastName
    department
*/

/**
 * Create a new User from request body
 * @param {*} req Request received by controller
 * @param {*} res Response generated by controller
 */

export const createUser = (req, res) => {
  req.body.id = uuidv4();
  users.push(req.body);
  res.send(
    `<h2 style = "color: blue">User with name ${req.body.firstName} is created</h2>`
  );
};

/**
 * Find User by request params id
 * @param {*} req Request received by controller
 * @param {*} res Response generated by controller
 */

export const findUserByID = (req, res) => {
  const curUser = findUser(req.params.id);
  if(curUser === undefined || curUser === null){
    res.send(`No user found with id = ${req.params.id}`);
  }
  res.send(curUser);
};


/**
 * Delete User by request params id
 * If given id is not in database, it sends 'user with given id not found.'
 * @param {*} req Request received by controller
 * @param {*} res Response generated by controller
 */

export const deleteUserByID = (req, res) => {

  const curUser = findUser(req.params.id);
  
  if (curUser !== undefined && curUser!==null) {
    const { firstName, lastName } = curUser;
    deleteUserFromDB(req.params.id);
    res.send(
      `<h1>User "${firstName} ${lastName}" is deleted from database.</h1>`
      );
    } else {
      res.send(`<h1>User with given ID ${req.params.id} not found</h1>`);
  }
};


/**
 * Update User by request params id
 * If given id is not in database, it sends 'No user found with given id'
 * @param {*} req Request received by controller
 * @param {*} res Response generated by controller
 */

export const updateUserByID = (req, res) => {
  const curUser = findUser(req.params.id);
  if(curUser=== undefined || curUser === null){
    res.send(`No user found with given id = ${req.params.id}`);
  } else{
      for(const i in req.body){
        curUser[i] = req.body[i];
      }
      res.send(`User with id ${req.params.id} is updated`);
  }
};
